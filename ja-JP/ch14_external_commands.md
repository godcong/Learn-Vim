# 外部コマンド

Unixシステム内には、それぞれが1つのことを上手くこなす、非常に特化した小さなコマンドがたくさんあります。これらのコマンドを連鎖させて連携させると、複雑な問題を解決できます。 Vimの内部からこれらのコマンドを使用できるとすばらしいと思いませんか？

この章では、Vimを拡張して外部コマンドとシームレスに連携する方法を学びます。

# バングコマンド

Vimには、3つのことを実行できるバング( `!`)コマンドがあります。

1.外部コマンドのSTDOUTを現在のバッファーに読み込みます。
2.バッファの内容をSTDINとして外部コマンドに書き込みます。
3. Vim内から外部コマンドを実行します。


# コマンドのSTDOUTをVimに読み込む

外部コマンドのSTDOUTを現在のバッファーに読み込む構文は次のとおりです。

```
:r!{cmd}
```

`:r`はVimの読み込みコマンドです。 `!`なしで使用すると、ファイルのコンテンツを取得できます。現在のディレクトリにファイル「file1.txt」があり、次を実行した場合:

```
:r file1.txt
```

Vimは `file1.txt`の内容を現在のバッファーに入れます。

`:r`コマンドに続いて`! `と外部コマンドを実行すると、そのコマンドの出力が現在のバッファーに挿入されます。 `ls`コマンドの結果を取得するには、以下を実行します:

```
:r!ls
```

それは次のようなものを返します:

```
file1.txt
file2.txt
file3.txt
```

`curl`コマンドからデータを読み取ることができます:

```
:r!curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

`r`コマンドはアドレスも受け付けます:

```
:10r!cat file1.txt
```

これで、 `cat file.txt`の実行によるSTDOUTが10行目に挿入されます。

# バッファの内容を外部コマンドに書き込む

ファイルの保存に加えて、書き込みコマンド( `:w`)を使用して、現在のバッファー内のテキストを外部コマンドのSTDINとして渡すこともできます。構文は次のとおりです。

```
:w !cmd
```

これらの式がある場合:

```
console.log("Hello Vim");
console.log("Vim is awesome");
```

マシンに[node](https://nodejs.org/en/)がインストールされていることを確認してから、次を実行します。

```
:w!ノード
```

Vimは「node」を使用してJavaScript式を実行し、「Hello Vim」と「Vim is awesome」を出力します。

`:w`コマンドを使用すると、Vimはグローバルコマンドと同様に、現在のバッファー内のすべてのテキストを使用します(ほとんどのコマンドラインコマンドは、範囲を渡さない場合、現在の行に対してのみコマンドを実行します)。 `:w`に特定のアドレスを渡すと:

```
:2w !node
```

Vimは2行目のテキストを `node`インタープリターにのみ使用します。

`:w!node`と`:w!ノード `。 `:w!node`を使用すると、現在のバッファーのテキストを外部コマンド` node`に「書き込み」ます。 `:w!ノード `、あなたはファイルを強制的に保存し、ファイルに「ノード」という名前を付けています。

# 外部コマンドの実行

bangコマンドを使用すると、Vim内から外部コマンドを実行できます。構文は次のとおりです。

```
:!cmd
```

現在のディレクトリの内容を長い形式で表示するには、次のコマンドを実行します。

```
:!ls -ls
```

PID 3456で実行されているプロセスを強制終了するには、次のコマンドを実行します。

```
:!kill -9 3456
```

Vimを離れることなく外部コマンドを実行できるため、タスクに集中できます。

# テキストのフィルタリング

`!`に範囲を指定すると、テキストのフィルタリングに使用できます。あなたがこれを持っていると仮定します:

```
hello vim
hello vim
```

`tr`(translate)コマンドを使って現在の行を大文字にしましょう。実行:

```
:。!tr '[:lower:]' '[:upper:]'
```

結果:

```
HELLO VIM
hello vim
```

内訳:
-`。!`は現在の行でフィルターコマンドを実行します。
-`!tr '[:lower:]' '[:upper:]'`は、 `tr`コマンドを呼び出して、すべての小文字を大文字に置き換えます。

外部コマンドをフィルターとして実行するには、範囲を渡すことが不可欠です。上記のコマンドを `.`(`:!tr '[:lower:]' '[:upper:]' `)なしで実行しようとすると、エラーが表示されます。

`awk`コマンドで両方の行の2列目を削除する必要があると仮定しましょう:

```
:%!awk "{print $1}"
```

結果:

```
hello
hello

```

内訳:
-`:％!`はすべての行でフィルターコマンドを実行します( `％`)。
-`awk" {print $ 1} "`は、一致の最初の列のみを印刷します。この場合、「こんにちは」という言葉。

ターミナルと同じように、チェーン演算子( `|`)を使用して複数のコマンドをチェーンできます。次のおいしい朝食アイテムのファイルがあるとします。

```
名目価格
チョコレートパンケーキ10
バターミルクパンケーキ9
ブルーベリーパンケーキ12
```

価格に基づいてそれらを並べ替え、等間隔のメニューのみを表示する必要がある場合は、次のコマンドを実行できます。

```
:％!awk 'NR> 1' | sort -nk 3 |列-t
```

結果:
```
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12

```
内訳：
-`：％!`はすべての行にフィルターを適用します( `％`)。
-`awk 'NR> 1'`は、行番号2以降のテキストのみを表示します。
-`|`は次のコマンドをチェーンします。
-`sort -nk 3`は、列3(` k 3`)の値を使用して数値( `n`)で並べ替えます。
-`column -t`は、テキストを等間隔に編成します。

# 通常モードコマンド

Vimには通常モードでフィルター演算子( `!`)があります。次の挨拶がある場合：

```
hello vim
hola vim
bonjour vim
salve vim
```

現在の行とその下の行を大文字にするには、次のコマンドを実行します。
```
!jtr '[a-z]' '[A-Z]'
```

内訳：
-`!j`は、現在の行とその下の行をターゲットとする通常のコマンドフィルター演算子(`! `)を実行します。通常のモード演算子であるため、文法規則「動詞+名詞」が適用されることを思い出してください。
-`tr '[a-z]' '[A-Z]'`は、小文字を大文字に置き換えます。

filter normalコマンドは、少なくとも1行以上のモーション/テキストオブジェクトでのみ機能します。 `!iwtr '[az]' '[AZ]'`を実行しようとした場合(内側の単語で `tr`を実行)、カーソルの単語ではなく、行全体に` tr`コマンドが適用されることがわかりますオンです。

# スマートな方法で外部コマンドを学ぶ

VimはIDEではありません。これは、設計によって高度に拡張可能な軽量のモーダルエディターです。この拡張性により、システムの外部コマンドに簡単にアクセスできます。これにより、VimはIDEになることから一歩近づきました。 Unixシステムは史上初のIDEだと誰かが言った。

バングコマンドは、知っている外部コマンドの数と同じくらい便利です。外部コマンドの知識が限られている場合でも心配しないでください。私にはまだ学ぶことがたくさんあります。これを継続的な学習の動機と考えてください。テキストをフィルタリングする必要があるときはいつでも、問題を解決できる外部コマンドがあるかどうかを確認してください。特定のコマンドに関するすべてを習得する必要はありません。現在のタスクを完了するために必要なものを学ぶだけです。